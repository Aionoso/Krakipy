

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>krakipy.krakipy &mdash; krakipy  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> krakipy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">krakipy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>krakipy.krakipy</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for krakipy.krakipy</h1><div class="highlight"><pre>
<span></span><span class="c1"># This file is part of krakipy.</span>
<span class="c1">#</span>
<span class="c1">#MIT LICENSE</span>
<span class="c1">#</span>
<span class="c1">#Permission is hereby granted, free of charge, to any person obtaining a copy of this software and</span>
<span class="c1">#associated documentation files (the “Software”), to deal in the Software without restriction, including</span>
<span class="c1">#without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies</span>
<span class="c1">#of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</span>
<span class="c1">#</span>
<span class="c1">#The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</span>
<span class="c1">#</span>
<span class="c1">#THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT</span>
<span class="c1">#NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.</span>
<span class="c1">#IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<span class="c1">#ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>


<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">to_datetime</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span><span class="p">,</span> <span class="n">concat</span><span class="p">,</span> <span class="n">json_normalize</span>
<span class="kn">from</span> <span class="nn">torpy.http.adapter</span> <span class="kn">import</span> <span class="n">TorHttpAdapter</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">HTTPError</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64encode</span><span class="p">,</span> <span class="n">b64decode</span>
<span class="kn">from</span> <span class="nn">torpy.client</span> <span class="kn">import</span> <span class="n">TorClient</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlencode</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span><span class="p">,</span> <span class="n">sha512</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span> 
<span class="kn">from</span> <span class="nn">pyotp</span> <span class="kn">import</span> <span class="n">TOTP</span>
<span class="kn">from</span> <span class="nn">hmac</span> <span class="kn">import</span> <span class="n">new</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">version</span>

<span class="k">def</span> <span class="nf">callratelimiter</span><span class="p">(</span><span class="n">increment</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">retry_decorator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_api_counter</span><span class="p">()</span>
            <span class="n">try_number</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_counter</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_tor</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">tor_refresh</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">api_counter</span> <span class="o">+=</span> <span class="n">increment</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">result</span>
                <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempt: </span><span class="si">{</span><span class="n">try_number</span><span class="si">:</span><span class="s2">_&gt;3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">try_number</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">*</span> <span class="n">increment</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_api_counter</span><span class="p">()</span>
                    <span class="k">continue</span>
            <span class="k">raise</span> <span class="n">CallRateLimitError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Call rate limiter exceeded: counter=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_counter</span><span class="si">}</span><span class="s2"> limit=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="si">}</span><span class="s2">. Please wait!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retry_decorator</span>
    <span class="k">return</span> <span class="n">call</span>


<div class="viewcode-block" id="KeyNotSetError"><a class="viewcode-back" href="../../index.html#krakipy.KeyNotSetError">[docs]</a><span class="k">class</span> <span class="nc">KeyNotSetError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This Error indicates that you tried to do a private request but did not set the Kraken API Keys.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="KrakenAPIError"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPIError">[docs]</a><span class="k">class</span> <span class="nc">KrakenAPIError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This Error indicates that in the response to your query had an error message when it was recieved.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>
    
<div class="viewcode-block" id="CallRateLimitError"><a class="viewcode-back" href="../../index.html#krakipy.CallRateLimitError">[docs]</a><span class="k">class</span> <span class="nc">CallRateLimitError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This Error indicates that you sent to many requests in the last 20s.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<span class="k">class</span> <span class="nc">Dark_Session</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_tor</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_tor</span> <span class="o">=</span> <span class="n">use_tor</span>
        <span class="k">if</span> <span class="n">use_tor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tor</span> <span class="o">=</span> <span class="n">TorClient</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_tor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_guard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tor</span><span class="o">.</span><span class="n">get_guard</span><span class="p">()</span>
            <span class="n">adapter</span> <span class="o">=</span> <span class="n">TorHttpAdapter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_guard</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;http://&quot;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://httpbin.org/ip&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;origin&quot;</span><span class="p">]</span>
            
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_tor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_guard</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_guard</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">_check_error</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">KrakenAPIError</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">])</span>


<div class="viewcode-block" id="KrakenAPI"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI">[docs]</a><span class="k">class</span> <span class="nc">KrakenAPI</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The KrakenAPI object stores the authentification information&quot;&quot;&quot;</span>

<div class="viewcode-block" id="KrakenAPI.__init__"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">secret_key</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">use_2fa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_tor</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tor_refresh</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an object that can hold the authentification information.</span>
<span class="sd">        The keys are only needed to perform private queries</span>
<span class="sd">        </span>
<span class="sd">        :param key: The key to the Kraken API (optional)</span>
<span class="sd">        :type key: str</span>
<span class="sd">        :param secret_key: The secret key to the Kraken API (optional)</span>
<span class="sd">        :type secret_key: str</span>
<span class="sd">        :param use_2fa: Is used to pass the desired two factor authentification (optional)</span>
<span class="sd">            </span>
<span class="sd">            - None = no two factor authentification (default)</span>
<span class="sd">            - {&quot;static password&quot;: your_static_2fa_password} = two factor authentification using a static password method. Example: use_2fa={&quot;static password&quot;: &quot;/&amp;59s^wqUU=baQ~W&quot;}</span>
<span class="sd">            - {&quot;2FA App&quot;: your_2fa_app_setup_key} = two factor authentification using OTP passwords like the Google Authenticator App does it. Example: use_2fa={&quot;2FA App&quot;: &quot;E452ZYHEX22AXGKIFUGQVPXF&quot;}</span>
<span class="sd">        </span>
<span class="sd">        :type use_2fa: None or dict</span>
<span class="sd">        :param use_tor: Weither or not to use the tor network for requests (optional)</span>

<span class="sd">            - False = use normal requests using the clearnet (default)</span>
<span class="sd">            - True = use tor requests using the darknet</span>

<span class="sd">        :type use_tor: bool</span>
<span class="sd">        :param tor_refresh: Amount of requests per session before the IP is changed (optional) default = 5</span>
<span class="sd">        :type tor_refresh: int</span>
<span class="sd">        :param retry: Amount of time between retries in sec (optional)</span>
<span class="sd">        :type retry: float</span>
<span class="sd">        :param limit: The maximum amount of retries (optional)</span>
<span class="sd">        :type limit: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_authentification</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">use_2fa</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">use_2fa</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;There can only be one authentification method per API-token.&quot;</span>
            <span class="n">authentification_methods</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;static password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_static_password</span><span class="p">,</span> <span class="s2">&quot;2FA App&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auth_2fa_app</span><span class="p">}</span>
            <span class="n">types</span> <span class="o">=</span> <span class="n">authentification_methods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">use_2fa</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">types</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;The authentification method called </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> is not supported. Only </span><span class="si">{</span><span class="n">types</span><span class="si">}</span><span class="s2"> are supported.&quot;</span>
            <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">use_2fa</span><span class="p">[</span><span class="n">method</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;The 2FA pasword has to be a string. </span><span class="si">{</span><span class="n">use_2fa</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="si">}</span><span class="s2"> is not a string.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span> <span class="o">=</span> <span class="n">method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_authentification</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">authentification_methods</span><span class="p">[</span><span class="n">method</span><span class="p">],</span> <span class="s2">&quot;password_2fa&quot;</span><span class="p">:</span> <span class="n">use_2fa</span><span class="p">[</span><span class="n">method</span><span class="p">]}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_secret</span> <span class="o">=</span> <span class="n">secret_key</span>
         
        <span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;https://api.kraken.com&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">Dark_Session</span><span class="p">(</span><span class="n">use_tor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_tor</span> <span class="o">=</span> <span class="n">use_tor</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_tor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;krakipy/&quot;</span> <span class="o">+</span> <span class="n">version</span><span class="o">.</span><span class="n">__version__</span> <span class="o">+</span> <span class="s2">&quot; (+&quot;</span> <span class="o">+</span> <span class="n">version</span><span class="o">.</span><span class="n">__url__</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tor_refresh</span> <span class="o">=</span> <span class="n">tor_refresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">time_of_last_query</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">=</span> <span class="n">retry</span></div>

    <span class="k">def</span> <span class="nf">_auth_static_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authentification</span><span class="p">[</span><span class="s2">&quot;password_2fa&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_auth_2fa_app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">TOTP</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_authentification</span><span class="p">[</span><span class="s2">&quot;password_2fa&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secret_key</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authentification</span>
        
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Closes the session</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;[</span><span class="si">{</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">VERSION:         </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">apiversion</span><span class="si">}</span><span class="se">\n</span><span class="s2">URI:             </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="si">}</span><span class="se">\n</span><span class="s2">API-Key:         </span><span class="si">{</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="k">else</span> <span class="s2">&quot;-&quot;</span><span class="si">}</span><span class="se">\n</span><span class="s2">API-Secretkey:   </span><span class="si">{</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_secret</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secret</span> <span class="k">else</span> <span class="s2">&quot;-&quot;</span><span class="si">}</span><span class="se">\n</span><span class="s2">API-2FA-method:  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span><span class="si">}</span><span class="se">\n</span><span class="s2">API-Counter:     </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_counter</span><span class="si">}</span><span class="se">\n</span><span class="s2">Using Tor:       </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">use_tor</span><span class="si">}</span><span class="se">\n</span><span class="s2">Request-Counter: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="si">}</span><span class="se">\n</span><span class="s2">Request-Limit:   </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="si">}</span><span class="se">\n</span><span class="s2">Request-Retry:   </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">retry</span><span class="si">}</span><span class="s2"> s&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_nonce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="n">time</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">urlpath</span><span class="p">):</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;nonce&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">urlpath</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="n">sha256</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>

        <span class="n">signature</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">b64decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_secret</span><span class="p">),</span> <span class="n">message</span><span class="p">,</span> <span class="n">sha512</span><span class="p">)</span>
        <span class="n">sigdigest</span> <span class="o">=</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">signature</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">sigdigest</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urlpath</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="o">+</span> <span class="n">urlpath</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">202</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="k">return</span> <span class="n">result</span>


    <span class="k">def</span> <span class="nf">_query_public</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">urlpath</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">+</span> <span class="s2">&quot;/public/&quot;</span> <span class="o">+</span> <span class="n">method</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query</span><span class="p">(</span><span class="n">urlpath</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_query_private</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_secret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">KeyNotSetError</span><span class="p">(</span><span class="s2">&quot;The Key and Secret-Key to the API need to be set to do private queries.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">urlpath</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">+</span> <span class="s2">&quot;/private/&quot;</span> <span class="o">+</span> <span class="n">method</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;nonce&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nonce</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authentification</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;otp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authentification</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;API-Key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">,</span> <span class="s2">&quot;API-Sign&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sign</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">urlpath</span><span class="p">)}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query</span><span class="p">(</span><span class="n">urlpath</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_public_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_public</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_check_error</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_do_private_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_private</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_check_error</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>




    <span class="c1">#Public Market Data</span>
<div class="viewcode-block" id="KrakenAPI.get_server_time"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_server_time">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_server_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Public Market Data</span>

<span class="sd">        Returns The time of the Kraken API server.</span>
<span class="sd">        </span>

<span class="sd">        :returns: Rfc1123 and unixtime</span>
<span class="sd">        :rtype: (str, int)</span>

<span class="sd">        Example: KrakenAPI.get_server_time() -&gt; (&quot;Sun,  6 Dec 20 14:12:39 +0000&quot;, 1607263959)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_public</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
        <span class="n">_check_error</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="s2">&quot;rfc1123&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="s2">&quot;unixtime&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="KrakenAPI.get_system_status"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_system_status">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_system_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Public Market Data</span>

<span class="sd">        Returns the current system status or trading mode and a timestamp.</span>


<span class="sd">        :returns: The system status and timestamp</span>
<span class="sd">        :rtype: (str, str)</span>

<span class="sd">        Example: KrakenAPI.get_system_status() -&gt; (&quot;online&quot;, &quot;2020-12-06T13:59:55Z&quot;)</span>

<span class="sd">        .. note::</span>

<span class="sd">            Possible status values include:</span>

<span class="sd">                - &quot;online&quot; (operational, full trading available)</span>
<span class="sd">                - &quot;cancel_only&quot; (existing orders are cancelable, but new orders cannot be created)</span>
<span class="sd">                - &quot;post_only&quot; (existing orders are cancelable, and only new post limit orders can be submitted)</span>
<span class="sd">                - &quot;maintenance&quot; (system is offline for maintenance)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_public</span><span class="p">(</span><span class="s2">&quot;SystemStatus&quot;</span><span class="p">)</span>
        <span class="n">_check_error</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="KrakenAPI.get_asset_info"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_asset_info">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_asset_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aclass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Public Market Data</span>

<span class="sd">        Get information about the assets that are available for deposit, withdrawal, trading and staking.</span>


<span class="sd">        :param asset: Comma delimited list of assets to get info on (optional) - default = &quot;all&quot;</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param aclass: Asset class (optional) - default = &quot;currency&quot;</span>
<span class="sd">        :type aclass: str</span>

<span class="sd">        :returns: DataFrame of asset names and their info</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_do_public_request</span><span class="p">(</span><span class="s2">&quot;Assets&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">aclass</span><span class="o">=</span><span class="n">aclass</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;aclass&quot;</span><span class="p">,</span> <span class="s2">&quot;altname&quot;</span><span class="p">,</span> <span class="s2">&quot;decimals&quot;</span><span class="p">,</span> <span class="s2">&quot;display_decimals&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">info</span><span class="p">[[</span><span class="s2">&quot;decimals&quot;</span><span class="p">,</span> <span class="s2">&quot;display_decimals&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[[</span><span class="s2">&quot;decimals&quot;</span><span class="p">,</span> <span class="s2">&quot;display_decimals&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="KrakenAPI.get_tradable_asset_pairs"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_tradable_asset_pairs">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_tradable_asset_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Public Market Data</span>


<span class="sd">        :param info: The info to retrieve (optional)</span>

<span class="sd">            - info = all info (default)</span>
<span class="sd">            - leverage = leverage info</span>
<span class="sd">            - fees = fees schedule</span>
<span class="sd">            - margin = margin info</span>

<span class="sd">        :type info: str</span>
<span class="sd">        :param pair: Comma delimited list of asset pairs to get info on (optional) - default = &quot;all&quot;</span>
<span class="sd">        :type pair: str</span>

<span class="sd">        :returns: DataFrame of pair names and their info</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_public_request</span><span class="p">(</span><span class="s2">&quot;AssetPairs&quot;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="n">pair</span><span class="p">)</span>
        <span class="n">pairs</span> <span class="o">=</span>  <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;altname&quot;</span><span class="p">,</span> <span class="s2">&quot;wsname&quot;</span><span class="p">,</span> <span class="s2">&quot;aclass_base&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;aclass_quote&quot;</span><span class="p">,</span> <span class="s2">&quot;quote&quot;</span><span class="p">,</span> <span class="s2">&quot;lot&quot;</span><span class="p">,</span> <span class="s2">&quot;pair_decimals&quot;</span><span class="p">,</span> <span class="s2">&quot;lot_decimals&quot;</span><span class="p">,</span> <span class="s2">&quot;lot_multiplier&quot;</span><span class="p">,</span> <span class="s2">&quot;leverage_buy&quot;</span><span class="p">,</span> <span class="s2">&quot;leverage_sell&quot;</span><span class="p">,</span> <span class="s2">&quot;fees&quot;</span><span class="p">,</span> <span class="s2">&quot;fees_maker&quot;</span><span class="p">,</span> <span class="s2">&quot;fee_volume_currency&quot;</span><span class="p">,</span> <span class="s2">&quot;margin_call&quot;</span><span class="p">,</span> <span class="s2">&quot;margin_stop&quot;</span><span class="p">,</span> <span class="s2">&quot;ordermin&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

        <span class="n">pairs</span><span class="p">[[</span><span class="s2">&quot;pair_decimals&quot;</span><span class="p">,</span> <span class="s2">&quot;lot_decimals&quot;</span><span class="p">,</span> <span class="s2">&quot;margin_call&quot;</span><span class="p">,</span> <span class="s2">&quot;margin_stop&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[[</span><span class="s2">&quot;pair_decimals&quot;</span><span class="p">,</span> <span class="s2">&quot;lot_decimals&quot;</span><span class="p">,</span> <span class="s2">&quot;margin_call&quot;</span><span class="p">,</span> <span class="s2">&quot;margin_stop&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">pairs</span><span class="p">[[</span><span class="s2">&quot;lot_multiplier&quot;</span><span class="p">,</span> <span class="s2">&quot;ordermin&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[[</span><span class="s2">&quot;lot_multiplier&quot;</span><span class="p">,</span> <span class="s2">&quot;ordermin&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pairs</span></div>

<div class="viewcode-block" id="KrakenAPI.get_ticker_information"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_ticker_information">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_ticker_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pair</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Public Market Data</span>


<span class="sd">        :param pair: Comma delimited list of asset pairs to get info on</span>
<span class="sd">        :type pair: str</span>

<span class="sd">        :returns: DataFrame of pair names and their ticker info</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            </span>
<span class="sd">            Today&quot;s prices start at midnight UTC</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_do_public_request</span><span class="p">(</span><span class="s2">&quot;Ticker&quot;</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="n">pair</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span></div>


<div class="viewcode-block" id="KrakenAPI.get_ohlc_data"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_ohlc_data">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_ohlc_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pair</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Public Market Data</span>

<span class="sd">        :param pair: Asset pair to get OHLC data for</span>
<span class="sd">        :type pair: str</span>
<span class="sd">        :param interval: The time frame interval in minutes (optional):</span>

<span class="sd">            - 1 (default) = 1 minute</span>
<span class="sd">            - 5 = 5 minutes</span>
<span class="sd">            - 15 = 15 minutes</span>
<span class="sd">            - 30 = 30 minutes</span>
<span class="sd">            - 60 = 1 hour</span>
<span class="sd">            - 240 = 4 hours</span>
<span class="sd">            - 1440 = 1 day</span>
<span class="sd">            - 10080 = 1 week</span>
<span class="sd">            - 21600 = 15 days</span>

<span class="sd">        :type interval: int</span>
<span class="sd">        :param since: Return committed OHLC data since given id (optional.  exclusive)</span>
<span class="sd">        :type since: int</span>

<span class="sd">        :returns: DataFrame of pair name and OHLC data</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>

<span class="sd">        .. note::</span>

<span class="sd">            The last entry in the OHLC array is for the current, not-yet-committed frame and will always be present, regardless of the value of since.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_public_request</span><span class="p">(</span><span class="s2">&quot;OHLC&quot;</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="n">pair</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="n">since</span><span class="p">)</span>
        <span class="n">ohlc</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="s2">&quot;vwap&quot;</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>

        <span class="n">last</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;last&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ohlc</span><span class="p">,</span> <span class="n">last</span></div>


<div class="viewcode-block" id="KrakenAPI.get_order_book"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_order_book">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_order_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pair</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Public Market Data</span>

<span class="sd">        :param pair: Asset pair to get market depth for</span>
<span class="sd">        :type pair: str</span>
<span class="sd">        :param count: Maximum number of asks/bids (optional) - default = 100, Range: [1..500]</span>
<span class="sd">        :type count: int</span>

<span class="sd">        :returns: Ask and bid DataFrame of pair name and market depth</span>
<span class="sd">        :rtype: (:py:attr:`pandas.DataFrame`, :py:attr:`pandas.DataFrame`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_public_request</span><span class="p">(</span><span class="s2">&quot;Depth&quot;</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="n">pair</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]</span>
        <span class="n">asks</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">pair</span><span class="p">][</span><span class="s2">&quot;asks&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="n">bids</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">pair</span><span class="p">][</span><span class="s2">&quot;bids&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">asks</span><span class="p">,</span> <span class="n">bids</span></div>


<div class="viewcode-block" id="KrakenAPI.get_recent_trades"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_recent_trades">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_recent_trades</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pair</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Public Market Data</span>

<span class="sd">        Returns the last 1000 trades by default</span>


<span class="sd">        :param pair: Asset pair to get trade data for</span>
<span class="sd">        :type pair: str</span>
<span class="sd">        :param since: Return trade data since given id (optional.  exclusive)</span>
<span class="sd">        :type since: int</span>

<span class="sd">        :returns: DataFrame of pair name and recent trade data and id to be used as since when polling for new trade data.</span>
<span class="sd">        :rtype: (:py:attr:`pandas.DataFrame`, int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_public_request</span><span class="p">(</span><span class="s2">&quot;Trades&quot;</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="n">pair</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="n">since</span><span class="p">)</span>
        <span class="n">trades</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;buy_sell&quot;</span><span class="p">,</span> <span class="s2">&quot;market_limit&quot;</span><span class="p">,</span> <span class="s2">&quot;misc&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>

        <span class="n">last</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;last&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">trades</span><span class="p">,</span> <span class="n">last</span></div>


<div class="viewcode-block" id="KrakenAPI.get_recent_spreads"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_recent_spreads">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_recent_spreads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pair</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Public Market Data</span>

<span class="sd">        :param pair: Asset pair to get spread data for</span>
<span class="sd">        :type pair: str</span>
<span class="sd">        :param since: Return trade data since given id (optional.  exclusive)</span>
<span class="sd">        :type since: int</span>

<span class="sd">        :returns: DataFrame of pair name and recent spread data and id to be used as since when polling for new spread data</span>
<span class="sd">        :rtype: (:py:attr:`pandas.DataFrame`, int)        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_public_request</span><span class="p">(</span><span class="s2">&quot;Spread&quot;</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="n">pair</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="n">since</span><span class="p">)</span>
        <span class="n">spread</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">pair</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;bid&quot;</span><span class="p">,</span> <span class="s2">&quot;ask&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="n">spread</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spread</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">spread</span><span class="p">[</span><span class="s2">&quot;spread&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spread</span><span class="o">.</span><span class="n">ask</span> <span class="o">-</span> <span class="n">spread</span><span class="o">.</span><span class="n">bid</span>

        <span class="n">last</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;last&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">spread</span><span class="p">,</span> <span class="n">last</span></div>





    <span class="c1">#Private User Data</span>
<div class="viewcode-block" id="KrakenAPI.get_account_balance"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_account_balance">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_account_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        Retrieve all cash balances, net of pending withdrawals.</span>

<span class="sd">        :returns: DataFrame of asset names and balance amount</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>

<span class="sd">        </span>
<span class="sd">        API Key Permissions Required: **Funds permissions - Query**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;Balance&quot;</span><span class="p">)</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;vol&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">balance</span></div>


<div class="viewcode-block" id="KrakenAPI.get_extended_balance"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_extended_balance">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_extended_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        Retrieve all extended account balances, including credits and held amounts. Balance available for trading is calculated as: available balance = balance + credit - credit_used - hold_trade</span>


<span class="sd">        :returns: DataFrame of asset names and balance amount</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Query**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;BalanceEx&quot;</span><span class="p">)</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">balance</span></div>


<div class="viewcode-block" id="KrakenAPI.get_trade_balance"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_trade_balance">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_trade_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="s2">&quot;ZEUR&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        Retrieve a summary of collateral balances, margin position valuations, equity and margin level.</span>


<span class="sd">        :param asset: Base asset used to determine balance - default = &quot;ZEUR&quot;</span>
<span class="sd">        :type asset: str</span>

<span class="sd">        :returns: DataFrame of trade balance info</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Query open orders &amp; trades**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;TradeBalance&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">)</span>
        <span class="n">tradebalance</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">asset</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;eb&quot;</span><span class="p">,</span> <span class="s2">&quot;tb&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;mf&quot;</span><span class="p">,</span> <span class="s2">&quot;ml&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tradebalance</span></div>


<div class="viewcode-block" id="KrakenAPI.get_open_orders"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_open_orders">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_open_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trades</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">userref</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        Retrieve information about currently open orders.</span>


<span class="sd">        :param trades: Whether or not to include trades in output (optional) - default = False</span>
<span class="sd">        :type trades: bool</span>
<span class="sd">        :param userref: Restrict results to given user reference id (optional)</span>
<span class="sd">        :type userref: str</span>

<span class="sd">        :returns: DataFrame of open order info with txid as the index</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Query open orders &amp; trades**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;OpenOrders&quot;</span><span class="p">,</span> <span class="n">trades</span><span class="o">=</span><span class="n">trades</span><span class="p">,</span> <span class="n">userref</span><span class="o">=</span><span class="n">userref</span><span class="p">)</span>
        <span class="n">openorders</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;descr&quot;</span><span class="p">,</span> <span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;limitprice&quot;</span><span class="p">,</span> <span class="s2">&quot;misc&quot;</span><span class="p">,</span> <span class="s2">&quot;oflags&quot;</span><span class="p">,</span> <span class="s2">&quot;opentm&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;refid&quot;</span><span class="p">,</span> <span class="s2">&quot;starttm&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;stopprice&quot;</span><span class="p">,</span> <span class="s2">&quot;userref&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_exec&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

        <span class="n">openorders</span><span class="p">[[</span><span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;opentm&quot;</span><span class="p">,</span> <span class="s2">&quot;starttm&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_exec&quot;</span><span class="p">,</span> <span class="s2">&quot;stopprice&quot;</span><span class="p">,</span> <span class="s2">&quot;limitprice&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">openorders</span><span class="p">[[</span><span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;opentm&quot;</span><span class="p">,</span> <span class="s2">&quot;starttm&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_exec&quot;</span><span class="p">,</span> <span class="s2">&quot;stopprice&quot;</span><span class="p">,</span> <span class="s2">&quot;limitprice&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">openorders</span></div>


<div class="viewcode-block" id="KrakenAPI.get_closed_orders"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_closed_orders">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_closed_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trades</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">userref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ofs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">closetime</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        Retrieve information about orders that have been closed (filled or cancelled). 50 results are returned at a time, the most recent by default.</span>

<span class="sd">        :param trades: Whether or not to include trades in output (optional) - default = False</span>
<span class="sd">        :type trades: bool</span>
<span class="sd">        :param userref: Restrict results to given user reference id (optional)</span>
<span class="sd">        :type userref: str</span>
<span class="sd">        :param start: Starting unix timestamp or order tx id of results (optional.  exclusive)</span>
<span class="sd">        :type start: int or str</span>
<span class="sd">        :param end: Ending unix timestamp or order tx id of results (optional.  inclusive)</span>
<span class="sd">        :type start: int or str</span>
<span class="sd">        :param ofs: The result offset</span>
<span class="sd">        :type ofs: int</span>
<span class="sd">        :param closetime: Which time to use (optional):</span>

<span class="sd">            - open</span>
<span class="sd">            - close</span>
<span class="sd">            - both (default)</span>

<span class="sd">        :type closetime: str</span>
<span class="sd">        </span>
<span class="sd">        :returns: DataFrame of of order info and amount of available order info matching criteria</span>
<span class="sd">        :rtype: (:py:attr:`pandas.DataFrame`, int)</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Query closed orders &amp; trades**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;ClosedOrders&quot;</span><span class="p">,</span> <span class="n">trades</span><span class="o">=</span><span class="n">trades</span><span class="p">,</span> <span class="n">userref</span><span class="o">=</span><span class="n">userref</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">ofs</span><span class="o">=</span><span class="n">ofs</span><span class="p">,</span> <span class="n">closetime</span><span class="o">=</span><span class="n">closetime</span><span class="p">)</span>
        <span class="n">closed</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;closed&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;refid&quot;</span><span class="p">,</span> <span class="s2">&quot;userref&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">,</span> <span class="s2">&quot;opentm&quot;</span><span class="p">,</span> <span class="s2">&quot;closetm&quot;</span><span class="p">,</span> <span class="s2">&quot;starttm&quot;</span><span class="p">,</span> <span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;descr&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_exec&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;stopprice&quot;</span><span class="p">,</span> <span class="s2">&quot;limitprice&quot;</span><span class="p">,</span> <span class="s2">&quot;misc&quot;</span><span class="p">,</span> <span class="s2">&quot;oflags&quot;</span><span class="p">,</span> <span class="s2">&quot;trades&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">closed</span><span class="p">[[</span><span class="s2">&quot;closetm&quot;</span><span class="p">,</span> <span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;opentm&quot;</span><span class="p">,</span> <span class="s2">&quot;starttm&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_exec&quot;</span><span class="p">,</span> <span class="s2">&quot;stopprice&quot;</span><span class="p">,</span> <span class="s2">&quot;limitprice&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">closed</span><span class="p">[[</span><span class="s2">&quot;closetm&quot;</span><span class="p">,</span> <span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;opentm&quot;</span><span class="p">,</span> <span class="s2">&quot;starttm&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_exec&quot;</span><span class="p">,</span> <span class="s2">&quot;stopprice&quot;</span><span class="p">,</span> <span class="s2">&quot;limitprice&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">closed</span><span class="p">,</span> <span class="n">count</span></div>


<div class="viewcode-block" id="KrakenAPI.query_orders_info"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.query_orders_info">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">query_orders_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txid</span><span class="p">,</span> <span class="n">trades</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">userref</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        Retrieve information about specific orders.</span>

<span class="sd">            </span>
<span class="sd">        :param trades: Whether or not to include trades in output (optional) - default = False</span>
<span class="sd">        :type trades: bool</span>
<span class="sd">        :param userref: Restrict results to given user reference id (optional)</span>
<span class="sd">        :type userref: str</span>
<span class="sd">        :param txid: Comma delimited list of transaction ids to query info about (50 maximum)</span>
<span class="sd">        :type txid: str</span>

<span class="sd">        :returns: DataFrame of associative orders info</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Query open orders &amp; trades** or **Orders and trades - Query closed orders &amp; trades**, depending on status of order</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;QueryOrders&quot;</span><span class="p">,</span> <span class="n">txid</span><span class="o">=</span><span class="n">txid</span><span class="p">,</span> <span class="n">trades</span><span class="o">=</span><span class="n">trades</span><span class="p">,</span> <span class="n">userref</span><span class="o">=</span><span class="n">userref</span><span class="p">)</span>
        <span class="n">orders</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;closetm&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;descr&quot;</span><span class="p">,</span> <span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;limitprice&quot;</span><span class="p">,</span> <span class="s2">&quot;misc&quot;</span><span class="p">,</span> <span class="s2">&quot;oflags&quot;</span><span class="p">,</span> <span class="s2">&quot;opentm&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">,</span> <span class="s2">&quot;refid&quot;</span><span class="p">,</span> <span class="s2">&quot;starttm&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;stopprice&quot;</span><span class="p">,</span> <span class="s2">&quot;trades&quot;</span><span class="p">,</span> <span class="s2">&quot;userref&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_exec&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

        <span class="n">orders</span><span class="p">[[</span><span class="s2">&quot;closetm&quot;</span><span class="p">,</span> <span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;opentm&quot;</span><span class="p">,</span> <span class="s2">&quot;starttm&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_exec&quot;</span><span class="p">,</span> <span class="s2">&quot;stopprice&quot;</span><span class="p">,</span> <span class="s2">&quot;limitprice&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">orders</span><span class="p">[[</span><span class="s2">&quot;closetm&quot;</span><span class="p">,</span> <span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;opentm&quot;</span><span class="p">,</span> <span class="s2">&quot;starttm&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_exec&quot;</span><span class="p">,</span> <span class="s2">&quot;stopprice&quot;</span><span class="p">,</span> <span class="s2">&quot;limitprice&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">orders</span></div>


<div class="viewcode-block" id="KrakenAPI.get_order_amends"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_order_amends">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_order_amends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        Retrieves an audit trail of amend transactions on the specified order. The list is ordered by ascending amend timestamp.</span>

<span class="sd">            </span>
<span class="sd">        :param order_id: The Kraken order identifier for the amended order.</span>
<span class="sd">        :type order_id: str</span>

<span class="sd">        :returns: DataFrame of associative orders info</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Query open orders &amp; trades** or **Orders and trades - Query closed orders &amp; trades**, depending on status of order</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;OrderAmends&quot;</span><span class="p">,</span> <span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">)</span>
        <span class="n">orders</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;amends&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;amend_id&quot;</span><span class="p">,</span> <span class="s2">&quot;amend_type&quot;</span><span class="p">,</span> <span class="s2">&quot;order_qty&quot;</span><span class="p">,</span> <span class="s2">&quot;remaining_qty&quot;</span><span class="p">,</span> <span class="s2">&quot;limit_price&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">])</span>

        <span class="n">orders</span><span class="p">[[</span><span class="s2">&quot;order_qty&quot;</span><span class="p">,</span> <span class="s2">&quot;remaining_qty&quot;</span><span class="p">,</span> <span class="s2">&quot;limit_price&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">orders</span><span class="p">[[</span><span class="s2">&quot;order_qty&quot;</span><span class="p">,</span> <span class="s2">&quot;remaining_qty&quot;</span><span class="p">,</span> <span class="s2">&quot;limit_price&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">orders</span></div>


<div class="viewcode-block" id="KrakenAPI.get_trades_history"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_trades_history">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_trades_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trade_type</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">trades</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ofs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        Retrieve information about trades/fills. 50 results are returned at a time, the most recent by default.</span>


<span class="sd">        :param trade_type: type of trade (optional):</span>

<span class="sd">            - all = all types (default)</span>
<span class="sd">            - any position = any position (open or closed)</span>
<span class="sd">            - closed position = positions that have been closed</span>
<span class="sd">            - closing position = any trade closing all or part of a position</span>
<span class="sd">            - no position = non-positional trades</span>

<span class="sd">        :type trade_type: str</span>
<span class="sd">        :param trades: Whether or not to include trades related to position in output (optional) - default = False</span>
<span class="sd">        :type trades: bool</span>
<span class="sd">        :param start: Starting unix timestamp or order tx id of results (optional.  exclusive)</span>
<span class="sd">        :type start: int or str</span>
<span class="sd">        :param end: Ending unix timestamp or order tx id of results (optional.  inclusive)</span>
<span class="sd">        :type start: int or str</span>
<span class="sd">        :param ofs: Result offset for pagination</span>
<span class="sd">        :type ofs: int</span>

<span class="sd">        :returns: DataFrame of trade info and the amount of available trades info matching criteria</span>
<span class="sd">        :rtype: (:py:attr:`pandas.DataFrame`, int)</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Query closed orders &amp; trades**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;TradesHistory&quot;</span><span class="p">,</span> <span class="n">trades</span><span class="o">=</span><span class="n">trades</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">ofs</span><span class="o">=</span><span class="n">ofs</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">trade_type</span><span class="p">)</span>
        <span class="n">trades</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;trades&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ordertxid&quot;</span><span class="p">,</span> <span class="s2">&quot;postxid&quot;</span><span class="p">,</span> <span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;ordertype&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;margin&quot;</span><span class="p">,</span> <span class="s2">&quot;misc&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">trades</span><span class="p">[[</span><span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;margin&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">trades</span><span class="p">[[</span><span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;margin&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">trades</span><span class="p">,</span> <span class="n">count</span></div>


<div class="viewcode-block" id="KrakenAPI.query_trades_info"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.query_trades_info">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">query_trades_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txid</span><span class="p">,</span> <span class="n">trades</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        Retrieve information about specific trades/fills.</span>

<span class="sd">        </span>
<span class="sd">        :param txid: Comma delimited list of transaction ids to query info about (20 maximum)</span>
<span class="sd">        :type txid: str</span>
<span class="sd">        :param trades: Whether or not to include trades related to position in output (optional) - default = False</span>
<span class="sd">        :type trades: bool</span>
<span class="sd">        </span>
<span class="sd">        :returns: DataFrame of associative trades info</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Query closed orders &amp; trades**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;QueryTrades&quot;</span><span class="p">,</span> <span class="n">txid</span><span class="o">=</span><span class="n">txid</span><span class="p">,</span> <span class="n">trades</span><span class="o">=</span><span class="n">trades</span><span class="p">)</span>
        <span class="n">trades</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;margin&quot;</span><span class="p">,</span> <span class="s2">&quot;misc&quot;</span><span class="p">,</span> <span class="s2">&quot;ordertxid&quot;</span><span class="p">,</span> <span class="s2">&quot;ordertype&quot;</span><span class="p">,</span> <span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;postxid&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">trades</span><span class="p">[[</span><span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;margin&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">trades</span><span class="p">[[</span><span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;margin&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trades</span></div>


<div class="viewcode-block" id="KrakenAPI.get_open_positions"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_open_positions">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_open_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">docalcs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">consolidation</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        :param txid: Comma delimited list of transaction ids to restrict output to</span>
<span class="sd">        :type txid: str</span>
<span class="sd">        :param docalcs: Whether or not to include profit/loss calculations (optional) - default = False</span>
<span class="sd">        :type docalcs: bool</span>
<span class="sd">        :param consolidation: What to consolidate the positions data around (optional) - &quot;market&quot; = will consolidate positions based on market pair</span>
<span class="sd">        :type consolidation: str</span>

<span class="sd">        :returns: A DataFrame of open position info</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Query open orders &amp; trades**</span>

<span class="sd">        .. note::</span>

<span class="sd">            Using the consolidation optional field will result in consolidated view of the data being returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;OpenPositions&quot;</span><span class="p">,</span> <span class="n">txid</span><span class="o">=</span><span class="n">txid</span><span class="p">,</span> <span class="n">docalcs</span><span class="o">=</span><span class="n">docalcs</span><span class="p">,</span> <span class="n">consolidation</span><span class="o">=</span><span class="n">consolidation</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ordertxid&quot;</span><span class="p">,</span> <span class="s2">&quot;posstatus&quot;</span><span class="p">,</span> <span class="s2">&quot;pair&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;ordertype&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_closed&quot;</span><span class="p">,</span> <span class="s2">&quot;margin&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;net&quot;</span><span class="p">,</span> <span class="s2">&quot;terms&quot;</span><span class="p">,</span> <span class="s2">&quot;rollovertm&quot;</span><span class="p">,</span> <span class="s2">&quot;misc&quot;</span><span class="p">,</span> <span class="s2">&quot;oflags&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">pos</span><span class="p">[[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_closed&quot;</span><span class="p">,</span> <span class="s2">&quot;margin&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;net&quot;</span><span class="p">,</span> <span class="s2">&quot;rollovertm&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;vol&quot;</span><span class="p">,</span> <span class="s2">&quot;vol_closed&quot;</span><span class="p">,</span> <span class="s2">&quot;margin&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;net&quot;</span><span class="p">,</span> <span class="s2">&quot;rollovertm&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pos</span></div>


<div class="viewcode-block" id="KrakenAPI.get_ledgers_info"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_ledgers_info">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_ledgers_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aclass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">selection_type</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ofs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        Retrieve information about ledger entries. 50 results are returned at a time, the most recent by default.</span>

<span class="sd">        </span>
<span class="sd">        :param asset: Comma delimited list of assets to restrict output to (optional) - default = &quot;all&quot;</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param aclass: Asset class (optional) - default = &quot;currency&quot;</span>
<span class="sd">        :type aclass: str</span>
<span class="sd">        :param selection_type: Type of trade (optional):</span>

<span class="sd">            - all (default)</span>
<span class="sd">            - deposit</span>
<span class="sd">            - withdrawal</span>
<span class="sd">            - trade</span>
<span class="sd">            - margin</span>

<span class="sd">        :type selection_type: str</span>
<span class="sd">        :param start: Starting unix timestamp or order tx id of results (optional.  exclusive)</span>
<span class="sd">        :type start: int or str</span>
<span class="sd">        :param end: Ending unix timestamp or order tx id of results (optional.  inclusive)</span>
<span class="sd">        :type start: int or str</span>
<span class="sd">        :param ofs: Result offset for pagination</span>
<span class="sd">        :type ofs: int</span>

<span class="sd">        :returns: DataFrame of associative ledgers info</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Data - Query ledger entries**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;Ledgers&quot;</span><span class="p">,</span> <span class="n">aclass</span><span class="o">=</span><span class="n">aclass</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">selection_type</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">ofs</span><span class="o">=</span><span class="n">ofs</span><span class="p">)</span>
        <span class="n">ledgers</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;ledger&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;refid&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;subtype&quot;</span><span class="p">,</span> <span class="s2">&quot;aclass&quot;</span><span class="p">,</span> <span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;balance&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ledgers</span><span class="p">[[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;balance&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ledgers</span><span class="p">[[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;balance&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ledgers</span></div>


<div class="viewcode-block" id="KrakenAPI.query_ledgers"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.query_ledgers">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">query_ledgers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">trades</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        Retrieve information about specific ledger entries.</span>


<span class="sd">        :param id: Comma delimited list of ledger ids to query info about (20 maximum)</span>
<span class="sd">        :type id: str</span>
<span class="sd">        :param trades: Whether or not to include trades related to position in output</span>
<span class="sd">        :type trades: bool (optional.) - default = False</span>

<span class="sd">        :returns: DataFrame of associative ledgers info</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Data - Query ledger entries**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;QueryLedgers&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">trades</span><span class="o">=</span><span class="n">trades</span><span class="p">)</span>
        <span class="n">ledgers</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;aclass&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;balance&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;refid&quot;</span><span class="p">,</span> <span class="s2">&quot;subtype&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

        <span class="n">ledgers</span><span class="p">[[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;balance&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">ledgers</span><span class="p">[[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;balance&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ledgers</span></div>


<div class="viewcode-block" id="KrakenAPI.get_trade_volume"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_trade_volume">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_trade_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pair</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        :param pair: Comma delimited list of asset pairs to get fee info on (optional)</span>
<span class="sd">        :type pair: str</span>
<span class="sd">        </span>
<span class="sd">        :returns: The volume currency, current discount volume, DataFrame of fees and DataFrame of maker fees</span>
<span class="sd">        :rtype: (str, float, :py:attr:`pandas.DataFrame`, :py:attr:`pandas.DataFrame`)</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Query**</span>

<span class="sd">        ..note:</span>

<span class="sd">            If an asset pair is on a maker/taker fee schedule, the taker side is given in fees and maker side in fees_maker. For pairs not on maker/taker, they will only be given in fees.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;TradeVolume&quot;</span><span class="p">,</span> <span class="n">pair</span><span class="o">=</span><span class="n">pair</span><span class="p">)</span>

        <span class="n">currency</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;currency&quot;</span><span class="p">])</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">])</span>

        <span class="n">fees</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fees&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;maxfee&quot;</span><span class="p">,</span> <span class="s2">&quot;minfee&quot;</span><span class="p">,</span> <span class="s2">&quot;nextfee&quot;</span><span class="p">,</span> <span class="s2">&quot;nextvolume&quot;</span><span class="p">,</span> <span class="s2">&quot;tiervolume&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">fees_maker</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fees_maker&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;maxfee&quot;</span><span class="p">,</span> <span class="s2">&quot;minfee&quot;</span><span class="p">,</span> <span class="s2">&quot;nextfee&quot;</span><span class="p">,</span> <span class="s2">&quot;nextvolume&quot;</span><span class="p">,</span> <span class="s2">&quot;tiervolume&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">currency</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">fees</span><span class="p">,</span> <span class="n">fees_maker</span></div>


<div class="viewcode-block" id="KrakenAPI.request_export_report"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.request_export_report">[docs]</a>    <span class="k">def</span> <span class="nf">request_export_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">report</span><span class="p">,</span> <span class="n">data_format</span><span class="o">=</span><span class="s2">&quot;CSV&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">starttm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">endtm</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        Request export of trades or ledgers.</span>


<span class="sd">        :param description: Report description info</span>
<span class="sd">        :type description: str</span>
<span class="sd">        :param report: Report type</span>

<span class="sd">            - trades</span>
<span class="sd">            - ledgers</span>

<span class="sd">        :type report: str</span>
<span class="sd">        :param data_format: The data format</span>

<span class="sd">            - CSV (default)</span>
<span class="sd">            - TSV</span>

<span class="sd">        :type data_format: str</span>
<span class="sd">        :param fields: Comma delimited list of fields to include in report (optional).  default = &quot;all&quot; </span>

<span class="sd">            trades:</span>

<span class="sd">                - ordertxid</span>
<span class="sd">                - time</span>
<span class="sd">                - ordertype</span>
<span class="sd">                - price</span>
<span class="sd">                - cost</span>
<span class="sd">                - fee</span>
<span class="sd">                - vol</span>
<span class="sd">                - margin</span>
<span class="sd">                - misc</span>
<span class="sd">                - ledgers</span>

<span class="sd">            ledgers:</span>

<span class="sd">                - refid</span>
<span class="sd">                - time</span>
<span class="sd">                - type</span>
<span class="sd">                - aclass</span>
<span class="sd">                - asset</span>
<span class="sd">                - amount</span>
<span class="sd">                - fee</span>
<span class="sd">                - vbalance</span>

<span class="sd">        :type fields: str</span>
<span class="sd">        :param asset: Comma delimited list of assets to get info on (optional) - default = &quot;all&quot;</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param starttm: Report start unixtime (optional).  default = one year before now</span>
<span class="sd">        :type starttm: int</span>
<span class="sd">        :param endtm: Report end unixtime (optional).  default = now</span>
<span class="sd">        :type endtm: int</span>

<span class="sd">        :returns: Report id</span>
<span class="sd">        :rtype: str</span>


<span class="sd">        API Key Permissions Required: **Data - Export data**</span>

<span class="sd">        .. note:: </span>

<span class="sd">            Field options are based on report type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;AddExport&quot;</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">data_format</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">starttm</span><span class="o">=</span><span class="n">starttm</span><span class="p">,</span> <span class="n">endtm</span><span class="o">=</span><span class="n">endtm</span><span class="p">)[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="KrakenAPI.get_export_report_status"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_export_report_status">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_export_report_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>

<span class="sd">        :param report: Report type:</span>

<span class="sd">            - trades</span>
<span class="sd">            - ledgers</span>

<span class="sd">        :type report: str</span>

<span class="sd">        :returns: DataFrame of reports and their info</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Data - Export data**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;ExportStatus&quot;</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;descr&quot;</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;report&quot;</span><span class="p">,</span> <span class="s2">&quot;subtype&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">,</span> <span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="s2">&quot;createdtm&quot;</span><span class="p">,</span> <span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;starttm&quot;</span><span class="p">,</span> <span class="s2">&quot;completedtm&quot;</span><span class="p">,</span> <span class="s2">&quot;datastarttm&quot;</span><span class="p">,</span> <span class="s2">&quot;dataendtm&quot;</span><span class="p">,</span> <span class="s2">&quot;aclass&quot;</span><span class="p">,</span> <span class="s2">&quot;asset&quot;</span><span class="p">])</span>
        <span class="n">status</span><span class="p">[[</span><span class="s2">&quot;flags&quot;</span><span class="p">,</span> <span class="s2">&quot;createdtm&quot;</span><span class="p">,</span> <span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;starttm&quot;</span><span class="p">,</span> <span class="s2">&quot;completedtm&quot;</span><span class="p">,</span> <span class="s2">&quot;datastarttm&quot;</span><span class="p">,</span> <span class="s2">&quot;dataendtm&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">status</span><span class="p">[[</span><span class="s2">&quot;flags&quot;</span><span class="p">,</span> <span class="s2">&quot;createdtm&quot;</span><span class="p">,</span> <span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;starttm&quot;</span><span class="p">,</span> <span class="s2">&quot;completedtm&quot;</span><span class="p">,</span> <span class="s2">&quot;datastarttm&quot;</span><span class="p">,</span> <span class="s2">&quot;dataendtm&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span></div>


<div class="viewcode-block" id="KrakenAPI.retrieve_export_report"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.retrieve_export_report">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">retrieve_export_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_id</span><span class="p">,</span> <span class="n">return_raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>
<span class="sd">        </span>
<span class="sd">        :param report_id: Report id</span>
<span class="sd">        :type report_id: str</span>
<span class="sd">        :param return_raw: Weither or not the report is returned as raw binary (optional) - default = False</span>
<span class="sd">        :type return_raw: bool</span>
<span class="sd">        :param dir: If given a directory the report will be saved there as a zipfile (optional)</span>
<span class="sd">        :type dir: str</span>
<span class="sd">        </span>
<span class="sd">        :returns: None or the binary of the compressed report.zip file</span>
<span class="sd">        :rtype: None or raw binary</span>


<span class="sd">        API Key Permissions Required: **Data - Export data**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">return_raw</span> <span class="ow">and</span> <span class="nb">dir</span> <span class="o">==</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;At least one way the Data is returned must be specified&quot;</span>

        <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;RetrieveExport&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">report_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">dir</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">Report_</span><span class="si">{}</span><span class="s2">.zip&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">report_id</span><span class="p">),</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_raw</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">report</span>            </div>


<div class="viewcode-block" id="KrakenAPI.delete_export_report"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.delete_export_report">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">delete_export_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">report_id</span><span class="p">,</span> <span class="n">remove_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Data</span>
<span class="sd">        </span>
<span class="sd">        :param report_id: Report id</span>
<span class="sd">        :type report_id: str</span>
<span class="sd">        :param remove_type: Removal type</span>

<span class="sd">            - cancel</span>
<span class="sd">            - delete</span>

<span class="sd">        :type remove_type: str</span>


<span class="sd">        :returns: Returns remove type</span>
<span class="sd">        :rtype: dict</span>


<span class="sd">        API Key Permissions Required: **Data - Export data**</span>

<span class="sd">        .. note::</span>

<span class="sd">            The delete remove type can only be used for a report that has already been processed. Use cancel for queued and processing statuses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;RemoveExport&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">report_id</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">remove_type</span><span class="p">)</span></div>

    



    <span class="c1">#Private User Trading</span>
<div class="viewcode-block" id="KrakenAPI.add_standard_order"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.add_standard_order">[docs]</a>    <span class="k">def</span> <span class="nf">add_standard_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pair</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">ordertype</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">displayvol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">price2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">leverage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reduce_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stptype</span><span class="o">=</span><span class="s2">&quot;cancel-newest&quot;</span><span class="p">,</span> <span class="n">oflags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">starttm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                           <span class="n">expiretm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">userref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deadline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">close_ordertype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">close_price</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">close_price2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trading_agreement</span><span class="o">=</span><span class="s2">&quot;agree&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Trading</span>

<span class="sd">        :param pair: Asset pair</span>
<span class="sd">        :type pair: str</span>
<span class="sd">        :param type: Type of order</span>

<span class="sd">            - buy</span>
<span class="sd">            - sell</span>

<span class="sd">        :type type: str</span>
<span class="sd">        :param ordertype: Order type:</span>

<span class="sd">            - market</span>
<span class="sd">            - limit (price = limit price)</span>
<span class="sd">            - iceberg</span>
<span class="sd">            - stop-loss (price = stop loss price)</span>
<span class="sd">            - take-profit (price = take profit price)</span>
<span class="sd">            - stop-loss-limit (price = stop loss trigger price, price2 = triggered limit price)</span>
<span class="sd">            - take-profit-limit (price = take profit trigger price, price2 = triggered limit price)</span>
<span class="sd">            - trailing-stop (price = trailing stop offset)</span>
<span class="sd">            - trailing-stop-limit (price = trailing stop offset, price2 = triggered limit offset)</span>
<span class="sd">            - settle-position</span>

<span class="sd">        :type ordertype: str</span>
<span class="sd">        :param volume: Order volume in lots</span>
<span class="sd">        :type volume: float</span>
<span class="sd">        :param displayvol: Used to edit an iceberg order, this is the visible order quantity in terms of the base asset. The rest of the order will be hidden, although the full volume can be filled at any time by any order of that size or larger that matches in the order book. displayvol can only be used with the limit order type, must be greater than 0, and less than volume.</span>
<span class="sd">        :type displayvol: float</span>
<span class="sd">        :param price: Price (optional.  dependent upon ordertype)</span>
<span class="sd">        :type price: float or str</span>
<span class="sd">        :param price2: Secondary price (optional.  dependent upon ordertype)</span>
<span class="sd">        :type price2: float or str</span>
<span class="sd">        :param leverage: Amount of leverage desired (optional.  default = none)</span>
<span class="sd">        :type leverage: int</span>
<span class="sd">        :param reduce_only: If true, order will only reduce a currently open position, not increase it or open a new position. (optional.  default = False)</span>
<span class="sd">        :type reduce_only: boolean</span>
<span class="sd">        :param stptype: Self trade prevention behavior definition (optional. default = &quot;cancel-newest&quot;):</span>

<span class="sd">            - cancel-newest - if self trade is triggered, arriving order will be canceled</span>
<span class="sd">            - cancel-oldest - if self trade is triggered, resting order will be canceled</span>
<span class="sd">            - cancel-both - if self trade is triggered, both arriving and resting orders will be canceled</span>

<span class="sd">        :type stptype: str</span>
<span class="sd">        :param oflags: Comma delimited list of order flags (optional):</span>

<span class="sd">            - viqc = volume in quote currency (not available for leveraged orders)</span>
<span class="sd">            - fcib = prefer fee in base currency</span>
<span class="sd">            - fciq = prefer fee in quote currency</span>
<span class="sd">            - nompp = no market price protection</span>
<span class="sd">            - post = post only order (available when ordertype = limit)</span>

<span class="sd">        :type oflags: str</span>
<span class="sd">        :param starttm: Scheduled start time (optional):</span>

<span class="sd">            - 0 = now (default)</span>
<span class="sd">            - +&lt;n&gt; = schedule start time &lt;n&gt; seconds from now</span>
<span class="sd">            - &lt;n&gt; = unix timestamp of start time</span>

<span class="sd">        :type starttm: int</span>
<span class="sd">        :param expiretm: Expiration time (optional):</span>

<span class="sd">            - 0 = no expiration (default)</span>
<span class="sd">            - +&lt;n&gt; = expire &lt;n&gt; seconds from now</span>
<span class="sd">            - &lt;n&gt; = unix timestamp of expiration time</span>
<span class="sd">            </span>
<span class="sd">        :type expiretm: int</span>
<span class="sd">        :param userref: User reference id. 32-bit signed number.  (optional)</span>
<span class="sd">        :type userref: str</span>
<span class="sd">        :param deadline: RFC3339 timestamp (e.g. &quot;2023-07-01T00:18:45Z&quot;) after which this order would be rejected.  (optional)</span>
<span class="sd">        :type deadline: str</span>
<span class="sd">        :param validate: Validate inputs only. do not submit order (optional)</span>
<span class="sd">        :type validate: bool</span>
<span class="sd">        :param close_ordertype: Optional closing order to add to system when order gets filled: order type</span>

<span class="sd">            - limit</span>
<span class="sd">            - stop-loss</span>
<span class="sd">            - take-profit</span>
<span class="sd">            - stop-loss-limit</span>
<span class="sd">            - take-profit-limit</span>

<span class="sd">        :type close_ordertype: str</span>
<span class="sd">        :param close_price: Price</span>
<span class="sd">        :type close_price: float or int</span>
<span class="sd">        :param  close_price2: Secondary price</span>
<span class="sd">        :type close_price2: float or int</span>
<span class="sd">        </span>
<span class="sd">        :returns: Dictionary of order description info</span>
<span class="sd">        :rtype: dict</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Create &amp; modify orders**</span>

<span class="sd">        .. note::</span>

<span class="sd">            - See Get tradable asset pairs for specifications on asset pair prices, lots, and leverage.</span>
<span class="sd">            - Prices can be preceded by +, -, or # to signify the price as a relative amount (with the exception of trailing stops, which are always relative). + adds the amount to the current offered price. - subtracts the amount from the current offered price. # will either add or subtract the amount to the current offered price, depending on the type and order type used. Relative prices can be suffixed with a % to signify the relative amount as a percentage of the offered price.</span>
<span class="sd">            - For orders using leverage, 0 can be used for the volume to auto-fill the volume needed to close out your position.</span>
<span class="sd">            - If you receive the error &quot;EOrder:Trading agreement required&quot;, refer to your API key management page for further details.</span>
<span class="sd">            - Volume can be specified as 0 for closing margin orders to automatically fill the requisite quantity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">validate</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">volume</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>
        <span class="n">price</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">if</span> <span class="n">price</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">price2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">price2</span><span class="p">)</span> <span class="k">if</span> <span class="n">price2</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">displayvol</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">displayvol</span><span class="p">)</span> <span class="k">if</span> <span class="n">displayvol</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">leverage</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">leverage</span><span class="p">)</span> <span class="k">if</span> <span class="n">leverage</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">close_price</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">close_price</span><span class="p">)</span> <span class="k">if</span> <span class="n">close_price</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">close_price2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">close_price2</span><span class="p">)</span> <span class="k">if</span> <span class="n">close_price2</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">arg</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span>
                <span class="n">arg</span> <span class="o">!=</span> <span class="s2">&quot;self&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">close_ordertype</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;close[ordertype]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;close_ordertype&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close_price</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;close[price]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;close_price&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close_price2</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;close[price2]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;close_price2&quot;</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_private</span><span class="p">(</span><span class="s2">&quot;AddOrder&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">_check_error</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">])</span></div>


    <span class="c1">#Private User Trading</span>
<div class="viewcode-block" id="KrakenAPI.edit_order"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.edit_order">[docs]</a>    <span class="k">def</span> <span class="nf">edit_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txid</span><span class="p">,</span> <span class="n">pair</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">displayvol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">price2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">oflags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">userref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deadline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cancel_response</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Trading</span>
<span class="sd">        </span>
<span class="sd">        :param txid: Transaction id</span>
<span class="sd">        :type txid: str</span>
<span class="sd">        :param pair: Asset pair</span>
<span class="sd">        :type pair: str</span>
<span class="sd">        :param volume: Order volume in lots</span>
<span class="sd">        :type volume: float</span>
<span class="sd">        :param displayvol: Used to edit an iceberg order, this is the visible order quantity in terms of the base asset. The rest of the order will be hidden, although the full volume can be filled at any time by any order of that size or larger that matches in the order book. displayvol can only be used with the limit order type, must be greater than 0, and less than volume.</span>
<span class="sd">        :type displayvol: float</span>
<span class="sd">        :param price: Price (optional.  dependent upon ordertype)</span>
<span class="sd">        :type price: float or str</span>
<span class="sd">        :param price2: Secondary price (optional.  dependent upon ordertype)</span>
<span class="sd">        :type price2: float or str</span>
<span class="sd">        :param oflags: Comma delimited list of order flags (optional):</span>

<span class="sd">            - viqc = volume in quote currency (not available for leveraged orders)</span>
<span class="sd">            - fcib = prefer fee in base currency</span>
<span class="sd">            - fciq = prefer fee in quote currency</span>
<span class="sd">            - nompp = no market price protection</span>
<span class="sd">            - post = post only order (available when ordertype = limit)</span>

<span class="sd">        :type oflags: str</span>
<span class="sd">        :param userref: User reference id. 32-bit signed number.  (optional)</span>
<span class="sd">        :type userref: str</span>
<span class="sd">        :param deadline: RFC3339 timestamp (e.g. &quot;2023-07-01T00:18:45Z&quot;) after which this order would be rejected.  (optional)</span>
<span class="sd">        :type deadline: str</span>
<span class="sd">        :param cancel_response: Used to interpret if client wants to receive pending replace, before the order is completely replaced (optional. Default = False)</span>
<span class="sd">        :type cancel_response: bool</span>
<span class="sd">        :param validate: Validate inputs only. do not submit order (optional)</span>
<span class="sd">        :type validate: bool</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        :returns: Dictionary of order description info</span>
<span class="sd">        :rtype: dict</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Create &amp; modify orders**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">validate</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">volume</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span>
        <span class="n">price</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">if</span> <span class="n">price</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">price2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">price2</span><span class="p">)</span> <span class="k">if</span> <span class="n">price2</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">displayvol</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">displayvol</span><span class="p">)</span> <span class="k">if</span> <span class="n">displayvol</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">close_price</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">close_price</span><span class="p">)</span> <span class="k">if</span> <span class="n">close_price</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">close_price2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">close_price2</span><span class="p">)</span> <span class="k">if</span> <span class="n">close_price2</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">arg</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span>
                <span class="n">arg</span> <span class="o">!=</span> <span class="s2">&quot;self&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_private</span><span class="p">(</span><span class="s2">&quot;EditOrder&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">_check_error</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="KrakenAPI.cancel_order"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.cancel_order">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Trading</span>

<span class="sd">        Cancel a particular open order (or set of open orders) by txid</span>

<span class="sd">        :param txid: Transaction id</span>
<span class="sd">        :type txid: str</span>

<span class="sd">        :returns: Number of orders canceled and weither order(s) is/are pending cancellation</span>
<span class="sd">        :rtype: (int, bool)</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Create &amp; modify orders** and **Orders and trades - Cancel &amp; close orders**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;CancelOrder&quot;</span><span class="p">,</span> <span class="n">txid</span><span class="o">=</span><span class="n">txid</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]),</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pending&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="KrakenAPI.cancel_all_orders"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.cancel_all_orders">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_all_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Trading</span>

<span class="sd">        Cancel all open orders</span>

<span class="sd">        :returns: Number of orders canceled</span>
<span class="sd">        :rtype: int</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Create &amp; modify orders** and **Orders and trades - Cancel &amp; close orders**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;CancelAll&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="KrakenAPI.cancel_all_orders_after"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.cancel_all_orders_after">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_all_orders_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Trading</span>

<span class="sd">        This method provides a &quot;Dead Man&quot;s Switch&quot; mechanism to protect the client from network malfunction, extreme latency or unexpected matching engine downtime. The client can send a request with a timeout (in seconds), that will start a countdown timer which will cancel all client orders when the timer expires. The client has to keep sending new requests to push back the trigger time, or deactivate the mechanism by specifying a timeout of 0. If the timer expires, all orders are cancelled and then the timer remains disabled until the client provides a new (non-zero) timeout.</span>
<span class="sd">        The recommended use is to make a call every 15 to 30 seconds, providing a timeout of 60 seconds. This allows the client to keep the orders in place in case of a brief disconnection or transient delay, while keeping them safe in case of a network breakdown. It is also recommended to disable the timer ahead of regularly scheduled trading engine maintenance (if the timer is enabled, all orders will be cancelled when the trading engine comes back from downtime - planned or otherwise).</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        :param timeout: Duration (in seconds) to set/extend the timer by</span>
<span class="sd">        :type timeout: int</span>

<span class="sd">        :returns: The timestamp when the request was recieved, The timestamp after which all orders will be cancelled, unless the timer is extended or disabled</span>
<span class="sd">        :rtype: str, str</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Create &amp; modify orders** and **Orders and trades - Cancel &amp; close orders**</span>

<span class="sd">        Example Return: KrakenAPI.cancel_all_orders_after(60) -&gt; (&quot;2021-03-24T17:41:56Z&quot;, &quot;2021-03-24T17:42:56Z&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;CancelAllOrdersAfter&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;currentTime&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;triggertime&quot;</span><span class="p">]</span></div>


<div class="viewcode-block" id="KrakenAPI.cancel_order_batch"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.cancel_order_batch">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_order_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orders</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Trading</span>

<span class="sd">        Cancel multiple open orders by txid or userref (maximum 50 total unique IDs/references)</span>
<span class="sd">        </span>
<span class="sd">        :param orders: List of open order transaction IDs (txid) or user references (userref), up to a maximum of 50 total unique IDs/references.</span>
<span class="sd">        :type orders: list of str or int</span>

<span class="sd">        :returns: Number of orders canceled</span>
<span class="sd">        :rtype: int</span>


<span class="sd">        API Key Permissions Required: **Orders and trades - Create &amp; modify orders** and **Orders and trades - Cancel &amp; close orders**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;CancelOrderBatch&quot;</span><span class="p">,</span> <span class="n">orders</span><span class="o">=</span><span class="n">orders</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])</span></div>





    <span class="c1">#Private User Funding</span>
<div class="viewcode-block" id="KrakenAPI.get_deposit_methods"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_deposit_methods">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_deposit_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Funding</span>

<span class="sd">        Retrieve methods available for depositing a particular asset.</span>


<span class="sd">        :param asset: Asset being deposited</span>
<span class="sd">        :type asset: str</span>

<span class="sd">        :returns: DataFrame of deposit methods</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Query** and **Funds permissions - Deposit**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;DepositMethods&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">)</span>
        <span class="n">depo</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;gen-address&quot;</span><span class="p">])</span>
        <span class="n">depo</span><span class="p">[</span><span class="s2">&quot;fee&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depo</span><span class="p">[</span><span class="s2">&quot;fee&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">depo</span></div>


<div class="viewcode-block" id="KrakenAPI.get_deposit_addresses"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_deposit_addresses">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_deposit_addresses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Funding</span>

<span class="sd">        Retrieve (or generate a new) deposit addresses for a particular asset and method.</span>


<span class="sd">        :param asset: Asset being deposited</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param method: Name of the deopsit method</span>
<span class="sd">        :type method: str</span>
<span class="sd">        :param new: Whether or not to generate a new address (optional.) - default = False</span>
<span class="sd">        :type new: bool</span>

<span class="sd">        :returns: DataFrame of associative deposit addresses</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Query**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;DepositAddresses&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="n">new</span><span class="p">)</span>
        
        <span class="n">depo</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;expiretm&quot;</span><span class="p">,</span> <span class="s2">&quot;new&quot;</span><span class="p">])</span>
        <span class="n">depo</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depo</span><span class="p">[</span><span class="s2">&quot;new&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillan</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">depo</span><span class="p">[</span><span class="s2">&quot;expiretm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depo</span><span class="p">[</span><span class="s2">&quot;expiretm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">depo</span></div>



<div class="viewcode-block" id="KrakenAPI.get_deposit_status"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_deposit_status">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_deposit_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Funding</span>

<span class="sd">        Retrieve information about recent deposits made.</span>


<span class="sd">        :param asset: Asset being deposited</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param method: Name of the deopsit method (optional)</span>
<span class="sd">        :type method: str</span>

<span class="sd">        :returns: DataFrame of deposit status information</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Query**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;DepositStatus&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="n">depo_status</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;aclass&quot;</span><span class="p">,</span> <span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;refid&quot;</span><span class="p">,</span> <span class="s2">&quot;txid&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">])</span>
        <span class="n">depo_status</span><span class="p">[[</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">depo_status</span><span class="p">[[</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">depo_status</span></div>


<div class="viewcode-block" id="KrakenAPI.get_withdrawal_info"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_withdrawal_info">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_withdrawal_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Funding</span>

<span class="sd">        Retrieve fee information about potential withdrawals for a particular asset, key and amount.</span>

<span class="sd">        </span>
<span class="sd">        :param asset: Asset being withdrawn</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param key: Withdrawal key name, as set up on your account</span>
<span class="sd">        :type key: str</span>
<span class="sd">        :param amount: Amount to withdraw</span>
<span class="sd">        :type amount: float</span>

<span class="sd">        :returns: DataFrame of associative withdrawal info</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Query** and **Funds permissions - Withdraw**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;WithdrawInfo&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">)</span>
        <span class="n">wd</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">asset</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">])</span>
        <span class="n">wd</span><span class="p">[[</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">wd</span><span class="p">[[</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wd</span></div>


<div class="viewcode-block" id="KrakenAPI.get_withdrawal_methods"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_withdrawal_methods">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_withdrawal_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aclass</span><span class="o">=</span><span class="s2">&quot;currency&quot;</span><span class="p">,</span> <span class="n">network</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Funding</span>

<span class="sd">        Retrieve a list of withdrawal methods available for the user.</span>

<span class="sd">        </span>
<span class="sd">        :param asset: Filter methods for specific asset (optional)</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param aclass: Filter methods for specific asset class (optional) - default = &quot;currency&quot;</span>
<span class="sd">        :type aclass: str</span>
<span class="sd">        :param network: Filter methods for specific network (optional)</span>
<span class="sd">        :type network: str</span>

<span class="sd">        :returns: DataFrame of withdrawal methods</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Query** and **Funds permissions - Withdraw**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;WithdrawMethods&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">aclass</span><span class="o">=</span><span class="n">aclass</span><span class="p">,</span> <span class="n">network</span><span class="o">=</span><span class="n">network</span><span class="p">)</span>
        <span class="n">wd</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;network&quot;</span><span class="p">,</span> <span class="s2">&quot;minimum&quot;</span><span class="p">])</span>
        <span class="n">wd</span><span class="p">[</span><span class="s2">&quot;minimum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wd</span><span class="p">[</span><span class="s2">&quot;minimum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wd</span></div>


<div class="viewcode-block" id="KrakenAPI.withdraw_funds"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.withdraw_funds">[docs]</a>    <span class="k">def</span> <span class="nf">withdraw_funds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Funding</span>

<span class="sd">        :param asset: Asset being withdrawn</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param key: Withdrawal key name, as set up on your account</span>
<span class="sd">        :type key: str</span>
<span class="sd">        :param amount: Amount to withdraw</span>
<span class="sd">        :type amount: float</span>
<span class="sd">        </span>
<span class="sd">        :returns: Reference id</span>
<span class="sd">        :rtype: str</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Withdraw**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;Withdraw&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">))[</span><span class="s2">&quot;refid&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="KrakenAPI.get_withdrawal_status"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_withdrawal_status">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_withdrawal_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Funding</span>

<span class="sd">        Retrieve information about recently requests withdrawals.</span>


<span class="sd">        :param asset: Asset being withdrawn</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param method: Name of the withdrawal method (optional)</span>
<span class="sd">        :type method: str</span>

<span class="sd">        :returns: DataFrame of withdrawal status information</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Withdraw** or **Data - Query ledger entries**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;WithdrawStatus&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="n">wd_status</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;aclass&quot;</span><span class="p">,</span> <span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;refid&quot;</span><span class="p">,</span> <span class="s2">&quot;txid&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;status-prop&quot;</span><span class="p">])</span>
        <span class="n">wd_status</span><span class="p">[[</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">wd_status</span><span class="p">[[</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wd_status</span></div>


<div class="viewcode-block" id="KrakenAPI.request_withdrawal_cancel"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.request_withdrawal_cancel">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">request_withdrawal_cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">refid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Funding</span>
<span class="sd">        </span>
<span class="sd">        Cancel a recently requested withdrawal, if it has not already been successfully processed.</span>

<span class="sd">        :param asset: Asset being withdrawn</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param refid: Withdrawal reference id</span>
<span class="sd">        :type refid: str</span>

<span class="sd">        :returns: True on success</span>
<span class="sd">        :rtype: bool</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Withdraw**, unless withdrawal is a **WalletTransfer**, then no permissions are required.</span>

<span class="sd">        .. note::</span>

<span class="sd">            **Cancelation cannot be guaranteed.** This will put in a cancelation request. Depending upon how far along the withdrawal process is, it may not be possible to cancel the withdrawal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;WithdrawCancel&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">refid</span><span class="o">=</span><span class="n">refid</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="KrakenAPI.wallet_transfer_to_futures"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.wallet_transfer_to_futures">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wallet_transfer_to_futures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Funding</span>

<span class="sd">        Transfer from Kraken spot wallet to Kraken Futures holding wallet. Note that a transfer in the other direction must be requested via the Kraken Futures API endpoint.</span>


<span class="sd">        :param asset: Asset being withdrawn</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param amount: Amount to withdraw</span>
<span class="sd">        :type amount: float</span>
<span class="sd">        </span>
<span class="sd">        :returns: Reference id</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;asset&quot;</span><span class="p">:</span> <span class="n">asset</span><span class="p">,</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;Spot Wallet&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;Futures Wallet&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="n">amount</span><span class="p">}</span> 
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_private</span><span class="p">(</span><span class="s2">&quot;WalletTransfer&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">_check_error</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="s2">&quot;refid&quot;</span><span class="p">])</span></div>

    


    <span class="c1">#Private User Staking</span>
<div class="viewcode-block" id="KrakenAPI.stake_asset"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.stake_asset">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">stake_asset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Staking</span>

<span class="sd">        Stake an asset from your spot wallet. This operation requires an API key with Withdraw funds permission.</span>

<span class="sd">        :param asset: Asset to stake</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param amount: Amount of the asset to stake</span>
<span class="sd">        :type amount: float</span>

<span class="sd">        :param method: Name of the staking option to use (refer to :py:attr:`KrakenAPI.get_stakeable_assets` for the correct method names for each asset)</span>
<span class="sd">        :type method: str</span>

<span class="sd">        </span>
<span class="sd">        :returns: Reference ID of the Staking Transaction</span>
<span class="sd">        :rtype: str</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Withdraw**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;Stake&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)[</span><span class="s2">&quot;refid&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="KrakenAPI.unstake_asset"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.unstake_asset">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unstake_asset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Staking</span>

<span class="sd">        Unstake an asset from your spot wallet. This operation requires an API key with Withdraw funds permission.</span>

<span class="sd">        :param asset: Asset to unstake (asset ID or altname). Must be a valid staking asset (e.g. XBT.M, XTZ.S, ADA.S)</span>
<span class="sd">        :type asset: str</span>
<span class="sd">        :param amount: Amount of the asset to unstake</span>
<span class="sd">        :type amount: float</span>

<span class="sd">        </span>
<span class="sd">        :returns: Reference ID of the Unstaking Transaction</span>
<span class="sd">        :rtype: str</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Withdraw**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;Unstake&quot;</span><span class="p">,</span> <span class="n">asset</span><span class="o">=</span><span class="n">asset</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="n">amount</span><span class="p">)[</span><span class="s2">&quot;refid&quot;</span><span class="p">])</span></div>

        
<div class="viewcode-block" id="KrakenAPI.get_stakeable_assets"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_stakeable_assets">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_stakeable_assets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Staking</span>

<span class="sd">        Returns the list of assets that the user is able to stake. This operation requires an API key with both Withdraw funds and Query funds permission.</span>
<span class="sd">        </span>
<span class="sd">        :returns: DataFrame of stakeable assets</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;Staking/Assets&quot;</span><span class="p">)</span>
        <span class="n">stakeable</span> <span class="o">=</span> <span class="n">json_normalize</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stakeable</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">stakeable</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;staking_asset&quot;</span><span class="p">,</span> <span class="s2">&quot;on_chain&quot;</span><span class="p">,</span> <span class="s2">&quot;can_stake&quot;</span><span class="p">,</span> <span class="s2">&quot;can_unstake&quot;</span><span class="p">,</span> <span class="s2">&quot;rewards_reward&quot;</span><span class="p">,</span> <span class="s2">&quot;rewards_type&quot;</span><span class="p">,</span> <span class="s2">&quot;minimum_amount_staking&quot;</span><span class="p">,</span> <span class="s2">&quot;minimum_amount_unstaking&quot;</span><span class="p">])</span>
        <span class="n">stakeable</span><span class="p">[[</span><span class="s2">&quot;rewards_reward&quot;</span><span class="p">,</span> <span class="s2">&quot;minimum_amount_staking&quot;</span><span class="p">,</span> <span class="s2">&quot;minimum_amount_unstaking&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">stakeable</span><span class="p">[[</span><span class="s2">&quot;rewards_reward&quot;</span><span class="p">,</span> <span class="s2">&quot;minimum_amount_staking&quot;</span><span class="p">,</span> <span class="s2">&quot;minimum_amount_unstaking&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stakeable</span></div>


<div class="viewcode-block" id="KrakenAPI.get_pending_staking_transactions"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_pending_staking_transactions">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_pending_staking_transactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Staking</span>

<span class="sd">        Returns the list of pending staking transactions. Once resolved, these transactions will appear on the List of Staking Transactions endpoint.</span>
<span class="sd">        This operation requires an API key with both Query funds and Withdraw funds permissions.</span>


<span class="sd">        :returns: DataFrame of pending staking transactions</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Query**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;Staking/Pending&quot;</span><span class="p">)</span>
        <span class="n">pend_stk</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;aclass&quot;</span><span class="p">,</span> <span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;refid&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">])</span>
        <span class="n">pend_stk</span><span class="p">[[</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pend_stk</span><span class="p">[[</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pend_stk</span></div>



<div class="viewcode-block" id="KrakenAPI.get_staking_transactions"><a class="viewcode-back" href="../../index.html#krakipy.KrakenAPI.get_staking_transactions">[docs]</a>    <span class="nd">@callratelimiter</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_staking_transactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private User Staking</span>

<span class="sd">        Returns the list of all staking transactions. This endpoint can only return up to 1000 of the most recent transactions.</span>
<span class="sd">        This operation requires an API key with Query funds permissions.</span>

<span class="sd">        </span>
<span class="sd">        :returns: DataFrame of all staking transactions</span>
<span class="sd">        :rtype: :py:attr:`pandas.DataFrame`</span>


<span class="sd">        API Key Permissions Required: **Funds permissions - Query**</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_private_request</span><span class="p">(</span><span class="s2">&quot;Staking/Transactions&quot;</span><span class="p">)</span>
        <span class="n">stk</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;aclass&quot;</span><span class="p">,</span> <span class="s2">&quot;asset&quot;</span><span class="p">,</span> <span class="s2">&quot;refid&quot;</span><span class="p">,</span> <span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;bond_start&quot;</span><span class="p">,</span> <span class="s2">&quot;bond_end&quot;</span><span class="p">])</span>
        <span class="n">stk</span><span class="p">[[</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;bond_start&quot;</span><span class="p">,</span> <span class="s2">&quot;bond_end&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">stk</span><span class="p">[[</span><span class="s2">&quot;amount&quot;</span><span class="p">,</span> <span class="s2">&quot;fee&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;bond_start&quot;</span><span class="p">,</span> <span class="s2">&quot;bond_end&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stk</span></div>

    
   


    <span class="k">def</span> <span class="nf">_update_api_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_counter</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_counter</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_of_last_query</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_of_last_query</span> <span class="o">=</span> <span class="n">now</span></div>



<div class="viewcode-block" id="add_dtime"><a class="viewcode-back" href="../../index.html#krakipy.add_dtime">[docs]</a><span class="k">def</span> <span class="nf">add_dtime</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extra</span>

<span class="sd">    Adds a new column &quot;dtime&quot; (datetime) from the column &quot;time&quot; (unixtime)</span>

<span class="sd">    :param df: A DataFrame with a column &quot;time&quot; in unixtime-format</span>
<span class="sd">    :type df: :py:attr:`pandas.DataFrame`</span>

<span class="sd">    :returns: df with a &quot;dtime&quot; column added</span>
<span class="sd">    :rtype: :py:attr:`pandas.DataFrame`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;dtime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="datetime_to_unixtime"><a class="viewcode-back" href="../../index.html#krakipy.datetime_to_unixtime">[docs]</a><span class="k">def</span> <span class="nf">datetime_to_unixtime</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extra</span>

<span class="sd">    Converts from datetime to unixtime</span>
<span class="sd">    </span>
<span class="sd">    :param dt: datetime object</span>
<span class="sd">    :type dt: :py:attr:`datetime.datetime`</span>

<span class="sd">    :returns: the unixtime of dt</span>
<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">dt</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span></div>


<div class="viewcode-block" id="unixtime_to_datetime"><a class="viewcode-back" href="../../index.html#krakipy.unixtime_to_datetime">[docs]</a><span class="k">def</span> <span class="nf">unixtime_to_datetime</span><span class="p">(</span><span class="n">ux</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extra</span>

<span class="sd">    Converts from unixtime to datetime </span>
<span class="sd">    </span>
<span class="sd">    :param ux: unixtime timestamp</span>
<span class="sd">    :type ux: int</span>

<span class="sd">    :returns: the datetime of ux</span>
<span class="sd">    :rtype: :py:attr:`datetime.datetime`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ux</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2025, Hubertus Wilisch.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>